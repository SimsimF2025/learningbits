
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Band III Vocab Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
        .arabic { font-family: 'Cairo', sans-serif; }
        .perspective-1000 { perspective: 1000px; }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }
        .card-flipped { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem;
        }
        .card-back { transform: rotateY(180deg); }
        #error-display {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            font-size: 12px;
            z-index: 9999;
            border-bottom: 1px solid #f87171;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "@google/genai": "https://esm.sh/@google/genai@1.41.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">
    <div id="error-display"></div>
    <div id="root">
        <div class="flex flex-col items-center justify-center min-h-screen">
            <div class="text-indigo-600 font-bold animate-pulse text-lg mb-2">Initializing Vocab Master...</div>
            <div class="text-slate-400 text-xs">If this takes more than 5 seconds, please check your internet connection.</div>
        </div>
    </div>

    <script type="module">
        import React, { useState, useEffect, useCallback, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { GoogleGenAI } from "@google/genai";

        // Global Error Handling for better debugging in iframes
        window.onerror = function(message, source, lineno, colno, error) {
            const display = document.getElementById('error-display');
            if (display) {
                display.style.display = 'block';
                display.innerHTML = `<strong>Error:</strong> ${message} <br/> <em>Note: Try refreshing the page.</em>`;
            }
            return false;
        };

        // Polyfill process
        window.process = window.process || { env: { API_KEY: "" } };

        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycby7FIHOhY5F-1Be-TKeDZpVpIXoAitIpXoMBXCncRgKXG_by0-ADK8yxifRol_sAnpE4g/exec';

        const VOCABULARY = {
            'List A': [
                { id: 'a1', entry: 'addition', pos: 'n', meaningArabic: 'Ø¥Ø¶Ø§ÙØ©/ ØªÙˆØ³ÙŠØ¹', meaningEnglish: 'Adding/extension/inclusion' },
                { id: 'a2', entry: 'advance', pos: 'n', meaningArabic: 'ØªÙ‚Ø¯Ù‘Ù…/ Ø§ÙƒØªØ´Ø§ÙØ§Øª', meaningEnglish: 'progress' },
                { id: 'a3', entry: 'analysis', pos: 'n', meaningArabic: 'ØªØ­Ù„ÙŠÙ„', meaningEnglish: 'Investigation/search/act of examining' },
                { id: 'a4', entry: 'appear', pos: 'v', meaningArabic: 'ÙŠØ¨Ø¯Ùˆ/ ÙŠØ¸Ù‡Ø±', meaningEnglish: 'Seem / to start to be seen' },
                { id: 'a5', entry: 'approach', pos: 'v, n', meaningArabic: 'ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ / Ù†Ù‡Ø¬', meaningEnglish: 'deal with, method' },
                { id: 'a6', entry: 'average', pos: 'adj', meaningArabic: 'Ù…Ø¹Ø¯Ù‘Ù„/ Ø¹Ø§Ø¯ÙŠ', meaningEnglish: 'ordinary, usual' },
                { id: 'a7', entry: 'challenge', pos: 'v', meaningArabic: 'ÙŠØ¹ØªØ±Ø¶/ ÙŠØªØ­Ø¯Ù‰', meaningEnglish: 'to compete / express disagreement' },
                { id: 'a8', entry: 'chance', pos: 'n', meaningArabic: 'ÙØ±ØµØ©/ Ù…Ø®Ø§Ø·Ø±Ø©', meaningEnglish: 'Risk / opportunity' },
                { id: 'a9', entry: 'characteristic', pos: 'n', meaningArabic: 'Ø³Ù…Ø© / ØµÙØ© Ù…Ù…ÙŠØ²Ø©', meaningEnglish: 'a typical or noticeable quality' },
                { id: 'a10', entry: 'consequence', pos: 'n', meaningArabic: 'Ø¹Ø§Ù‚Ø¨Ø©', meaningEnglish: 'as a result' },
                { id: 'a11', entry: 'debate', pos: 'v, n', meaningArabic: 'Ù…Ù†Ø§Ù‚Ø´Ø©', meaningEnglish: 'discussion of a subject' },
                { id: 'a12', entry: 'decrease', pos: 'v, n', meaningArabic: 'ÙŠÙ†Ø®ÙØ¶ / Ø§Ù†Ø®ÙØ§Ø¶', meaningEnglish: 'to become less' },
                { id: 'a13', entry: 'definition', pos: 'n', meaningArabic: 'ØªØ¹Ø±ÙŠÙ', meaningEnglish: 'statement of the exact meaning' },
                { id: 'a14', entry: 'demonstrate', pos: 'v', meaningArabic: 'ÙŠØ¸Ù‡Ø± / ÙŠØ¨Ø±Ù‡Ù†', meaningEnglish: 'to show or make clear' },
                { id: 'a15', entry: 'despite', pos: 'prep', meaningArabic: 'Ø¹Ù„Ù‰ Ø§Ù„Ø±ØºÙ… Ù…Ù†', meaningEnglish: 'without being influenced' },
                { id: 'a16', entry: 'detail', pos: 'n', meaningArabic: 'ØªÙØµÙŠÙ„', meaningEnglish: 'single piece of information' },
                { id: 'a17', entry: 'device', pos: 'n', meaningArabic: 'Ø¬Ù‡Ø§Ø²', meaningEnglish: 'invented object' },
                { id: 'a18', entry: 'digital', pos: 'adj', meaningArabic: 'Ø±Ù‚Ù…ÙŠ', meaningEnglish: 'using computers' },
                { id: 'a19', entry: 'direct', pos: 'adj, v', meaningArabic: 'Ù…Ø¨Ø§Ø´Ø± / ÙŠÙˆØ¬Ù‡', meaningEnglish: 'without anything in between' },
                { id: 'a20', entry: 'discovery', pos: 'n', meaningArabic: 'Ø§ÙƒØªØ´Ø§Ù', meaningEnglish: 'finding information' }
            ],
            'List B': [
                { id: 'b1', entry: 'acquire', pos: 'v', meaningArabic: 'ÙŠÙƒØªØ³Ø¨', meaningEnglish: 'to get or obtain' },
                { id: 'b2', entry: 'agriculture', pos: 'n', meaningArabic: 'Ø§Ù„Ø²Ø±Ø§Ø¹Ø©', meaningEnglish: 'farming' },
                { id: 'b3', entry: 'anxious', pos: 'adj', meaningArabic: 'Ù‚Ù„Ù‚', meaningEnglish: 'worried' },
                { id: 'b4', entry: 'atmosphere', pos: 'n', meaningArabic: 'Ø§Ù„ØºÙ„Ø§Ù Ø§Ù„Ø¬ÙˆÙŠ', meaningEnglish: 'the air in a place' },
                { id: 'b5', entry: 'calculate', pos: 'v', meaningArabic: 'ÙŠØ­Ø³Ø¨', meaningEnglish: 'mathematical determination' },
                { id: 'b6', entry: 'competitive', pos: 'adj', meaningArabic: 'ØªÙ†Ø§ÙØ³ÙŠ', meaningEnglish: 'wanting to win' },
                { id: 'b7', entry: 'continent', pos: 'n', meaningArabic: 'Ù‚Ø§Ø±Ø©', meaningEnglish: 'large land mass' },
                { id: 'b8', entry: 'decade', pos: 'n', meaningArabic: 'Ø¹Ù‚Ø¯', meaningEnglish: 'ten years' },
                { id: 'b9', entry: 'deliver', pos: 'v, n', meaningArabic: 'ÙŠÙˆØµÙ‘Ù„', meaningEnglish: 'take goods to place' },
                { id: 'b10', entry: 'detect', pos: 'v', meaningArabic: 'ÙŠØªØ­Ø±Ù‘Ù‰', meaningEnglish: 'notice something hidden' },
                { id: 'b11', entry: 'disaster', pos: 'n', meaningArabic: 'ÙƒØ§Ø±Ø«Ø©', meaningEnglish: 'event causing great harm' },
                { id: 'b12', entry: 'disease', pos: 'n', meaningArabic: 'Ù…Ø±Ø¶', meaningEnglish: 'illness from infection' },
                { id: 'b13', entry: 'distance', pos: 'n', meaningArabic: 'Ù…Ø³Ø§ÙØ©', meaningEnglish: 'space between places' },
                { id: 'b14', entry: 'double', pos: 'adj, v', meaningArabic: 'Ù…Ø¶Ø§Ø¹Ù', meaningEnglish: 'twice as much' },
                { id: 'b15', entry: 'dramatic', pos: 'adj', meaningArabic: 'Ù…Ø«ÙŠØ±Ø©', meaningEnglish: 'sudden, noticeable' },
                { id: 'b16', entry: 'economical', pos: 'adj', meaningArabic: 'Ø§Ù‚ØªØµØ§Ø¯ÙŠ', meaningEnglish: 'saving money' },
                { id: 'b17', entry: 'efficiency', pos: 'n', meaningArabic: 'ÙƒÙØ§Ø¡Ø©', meaningEnglish: 'working well' },
                { id: 'b18', entry: 'emphasis', pos: 'n', meaningArabic: 'ØªÙˆÙƒÙŠØ¯', meaningEnglish: 'particular importance' },
                { id: 'b19', entry: 'encounter', pos: 'v, n', meaningArabic: 'ÙŠÙˆØ§Ø¬Ù‡', meaningEnglish: 'experience unpleasantness' },
                { id: 'b20', entry: 'enormous', pos: 'adj', meaningArabic: 'Ø¶Ø®Ù…', meaningEnglish: 'very large' }
            ],
            'List C': [
                { id: 'c1', entry: 'absorb', pos: 'v', meaningArabic: 'ÙŠÙ…ØªØµ', meaningEnglish: 'soak up' },
                { id: 'c2', entry: 'ambition', pos: 'n', meaningArabic: 'Ø·Ù…ÙˆØ­', meaningEnglish: 'desire for goal' },
                { id: 'c3', entry: 'argue', pos: 'v', meaningArabic: 'ÙŠØ¬Ø§Ø¯Ù„', meaningEnglish: 'give reasons to persuade' },
                { id: 'c4', entry: 'ashamed', pos: 'adj', meaningArabic: 'Ø®Ø¬Ù„Ø§Ù†', meaningEnglish: 'feeling guilty' },
                { id: 'c5', entry: 'barrier', pos: 'n', meaningArabic: 'Ø­Ø§Ø¬Ø²', meaningEnglish: 'preventing movement' },
                { id: 'c6', entry: 'capture', pos: 'v', meaningArabic: 'ÙŠØ£Ø³Ø±', meaningEnglish: 'catch prisoner' },
                { id: 'c7', entry: 'ceremony', pos: 'n', meaningArabic: 'Ù…Ø±Ø§Ø³Ù…', meaningEnglish: 'formal event' },
                { id: 'c8', entry: 'courage', pos: 'n', meaningArabic: 'Ø´Ø¬Ø§Ø¹Ø©', meaningEnglish: 'ability to face danger' },
                { id: 'c9', entry: 'debt', pos: 'n', meaningArabic: 'Ø¯ÙŽÙŠÙ’Ù†', meaningEnglish: 'money owed' },
                { id: 'c10', entry: 'distinguish', pos: 'v', meaningArabic: 'ÙŠÙ…ÙŠØ²', meaningEnglish: 'notice difference' },
                { id: 'c11', entry: 'editor', pos: 'n', meaningArabic: 'Ù…Ø­Ø±Ø±', meaningEnglish: 'person in charge' },
                { id: 'c12', entry: 'evidence', pos: 'n', meaningArabic: 'Ø¯Ù„ÙŠÙ„', meaningEnglish: 'anything that proves' },
                { id: 'c13', entry: 'exhibition', pos: 'n', meaningArabic: 'Ù…Ø¹Ø±Ø¶', meaningEnglish: 'public show' },
                { id: 'c14', entry: 'failure', pos: 'n', meaningArabic: 'ÙØ´Ù„', meaningEnglish: 'lack of success' },
                { id: 'c15', entry: 'fascinating', pos: 'adj', meaningArabic: 'Ø±Ø§Ø¦Ø¹', meaningEnglish: 'extremely interesting' },
                { id: 'c16', entry: 'generate', pos: 'v', meaningArabic: 'ÙŠÙˆÙ„Ø¯', meaningEnglish: 'produce or create' },
                { id: 'c17', entry: 'guarantee', pos: 'v, n', meaningArabic: 'ÙŠØ¶Ù…Ù†', meaningEnglish: 'promise of happening' },
                { id: 'c18', entry: 'heritage', pos: 'n', meaningArabic: 'ØªØ±Ø§Ø«', meaningEnglish: 'culture features' },
                { id: 'c19', entry: 'identity', pos: 'n', meaningArabic: 'Ù‡ÙˆÙŠØ©', meaningEnglish: 'who a person is' },
                { id: 'c20', entry: 'impact', pos: 'n', meaningArabic: 'ØªØ£Ø«ÙŠØ±', meaningEnglish: 'powerful effect' }
            ],
            'List D': [
                { id: 'd1', entry: 'aggressive', pos: 'adj', meaningArabic: 'Ø¹Ø¯ÙˆØ§Ù†ÙŠ', meaningEnglish: 'forceful' },
                { id: 'd2', entry: 'ambassador', pos: 'n', meaningArabic: 'Ø³ÙÙŠØ±', meaningEnglish: 'official representative' },
                { id: 'd3', entry: 'bargain', pos: 'n', meaningArabic: 'ØµÙÙ‚Ø©', meaningEnglish: 'sale at lower price' },
                { id: 'd4', entry: 'branch', pos: 'n', meaningArabic: 'ÙØ±Ø¹', meaningEnglish: 'business part' },
                { id: 'd5', entry: 'bucket', pos: 'n', meaningArabic: 'Ø³Ø·Ù„', meaningEnglish: 'open top container' },
                { id: 'd6', entry: 'cave', pos: 'n', meaningArabic: 'ÙƒÙ‡Ù', meaningEnglish: 'hole in hill' },
                { id: 'd7', entry: 'customs', pos: 'n', meaningArabic: 'Ø¬Ù…Ø§Ø±Ùƒ', meaningEnglish: 'import taxes' },
                { id: 'd8', entry: 'defeat', pos: 'v, n', meaningArabic: 'ÙŠÙ‡Ø²Ù…', meaningEnglish: 'win against' },
                { id: 'd9', entry: 'dreadful', pos: 'adj', meaningArabic: 'Ù…Ø±ÙˆÙ‘Ø¹', meaningEnglish: 'causing shock' },
                { id: 'd10', entry: 'explode', pos: 'v', meaningArabic: 'ÙŠÙ†ÙØ¬Ø±', meaningEnglish: 'break violently' },
                { id: 'd11', entry: 'factor', pos: 'n', meaningArabic: 'Ø¹Ø§Ù…Ù„', meaningEnglish: 'causes a result' },
                { id: 'd12', entry: 'global', pos: 'adj', meaningArabic: 'Ø¹Ø§Ù„Ù…ÙŠ', meaningEnglish: 'whole world' },
                { id: 'd13', entry: 'hesitate', pos: 'v', meaningArabic: 'ÙŠØªØ±Ø¯Ø¯', meaningEnglish: 'pause before doing' },
                { id: 'd14', entry: 'indicate', pos: 'v', meaningArabic: 'ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰', meaningEnglish: 'show or point' },
                { id: 'd15', entry: 'justice', pos: 'n', meaningArabic: 'Ø¹Ø¯Ø§Ù„Ø©', meaningEnglish: 'fair treatment' },
                { id: 'd16', entry: 'knowledge', pos: 'n', meaningArabic: 'Ù…Ø¹Ø±ÙØ©', meaningEnglish: 'understanding' },
                { id: 'd17', entry: 'label', pos: 'n, v', meaningArabic: 'Ù…Ù„ØµÙ‚', meaningEnglish: 'info paper' },
                { id: 'd18', entry: 'maintain', pos: 'v', meaningArabic: 'ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰', meaningEnglish: 'keep in existence' },
                { id: 'd19', entry: 'objective', pos: 'n, adj', meaningArabic: 'Ù‡Ø¯Ù', meaningEnglish: 'plan to do' },
                { id: 'd20', entry: 'participate', pos: 'v', meaningArabic: 'ÙŠØ´Ø§Ø±Ùƒ', meaningEnglish: 'take part in' }
            ]
        };

        const useAudio = () => {
            const audioCtx = useRef(null);
            const initAudio = () => { if (!audioCtx.current) audioCtx.current = new (window.AudioContext || window.webkitAudioContext)(); };
            const playSound = (freq, type, duration, volume = 0.1) => {
                try {
                    if (!audioCtx.current) return;
                    if (audioCtx.current.state === 'suspended') audioCtx.current.resume();
                    const osc = audioCtx.current.createOscillator();
                    const gain = audioCtx.current.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, audioCtx.current.currentTime);
                    gain.gain.setValueAtTime(volume, audioCtx.current.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.current.currentTime + duration);
                    osc.connect(gain); gain.connect(audioCtx.current.destination);
                    osc.start(); osc.stop(audioCtx.current.currentTime + duration);
                } catch (e) { console.warn("Audio play failed", e); }
            };
            return {
                initAudio,
                playFlip: () => playSound(400, 'sine', 0.1, 0.05),
                playMatch: () => { playSound(600, 'sine', 0.1, 0.1); setTimeout(() => playSound(800, 'sine', 0.15, 0.1), 100); },
                playError: () => playSound(150, 'triangle', 0.3, 0.1)
            };
        };

        const Header = ({ isMuted, onToggleMute }) => (
            <header className="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between sticky top-0 z-50">
                <div className="flex items-center gap-3">
                    <div className="bg-indigo-600 text-white p-2 rounded-lg shadow-md"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg></div>
                    <div><h1 className="font-bold text-lg sm:text-xl text-slate-900 leading-none">Band III Vocab Master</h1><p className="text-[10px] text-slate-500 mt-1 uppercase tracking-[0.2em] font-extrabold">Learning Game</p></div>
                </div>
                <button onClick={onToggleMute} className="p-2 hover:bg-slate-100 rounded-full text-slate-500 transition-colors">{isMuted ? 'ðŸ”‡' : 'ðŸ”Š'}</button>
            </header>
        );

        const VocabCard = ({ card, isFlipped, isMatched, onClick }) => (
            <div className={`relative w-full aspect-[3/4] cursor-pointer group perspective-1000 ${isMatched ? 'opacity-40 grayscale pointer-events-none' : ''}`} onClick={onClick}>
                <div className={`card-inner ${isFlipped || isMatched ? 'card-flipped' : ''} shadow-sm rounded-xl transition-all`}>
                    <div className="card-front bg-white border-2 border-slate-100 p-4"><div className="w-10 h-10 bg-indigo-50 rounded-full flex items-center justify-center text-indigo-400"><span className="text-xl font-black">?</span></div></div>
                    <div className={`card-back p-4 border-2 shadow-inner text-center ${card.type === 'term' ? 'bg-indigo-600 text-white border-indigo-700' : 'bg-emerald-50 text-emerald-900 border-emerald-200'}`}>
                        <div className="flex flex-col items-center justify-center h-full">
                            <span className="text-[9px] opacity-70 mb-2 uppercase tracking-[0.15em] font-extrabold">{card.isArabic ? 'Meaning' : 'Vocabulary'}</span>
                            <p className={`font-bold leading-tight break-words overflow-hidden ${card.isArabic ? 'arabic text-lg' : 'text-sm'}`}>{card.content}</p>
                        </div>
                    </div>
                </div>
            </div>
        );

        function App() {
            const [gameState, setGameState] = useState({ studentName: '', studentClass: '', score: 0, timer: 0, isGameStarted: false, isGameOver: false, matchedPairs: [], selectedList: 'List A', mode: 'English-Arabic', difficulty: 'Easy (10 words)' });
            const [isMuted, setIsMuted] = useState(false);
            const [cards, setCards] = useState([]);
            const [flippedCards, setFlippedCards] = useState([]);
            const [submitStatus, setSubmitStatus] = useState('idle');
            const { initAudio, playFlip, playMatch, playError } = useAudio();

            useEffect(() => {
                let interval;
                if (gameState.isGameStarted && !gameState.isGameOver) {
                    interval = setInterval(() => setGameState(prev => ({ ...prev, timer: prev.timer + 1 })), 1000);
                }
                return () => clearInterval(interval);
            }, [gameState.isGameStarted, gameState.isGameOver]);

            useEffect(() => { if (gameState.isGameOver) submitResultToSheet(); }, [gameState.isGameOver]);

            const submitResultToSheet = async () => {
                if (submitStatus === 'submitting' || submitStatus === 'success') return;
                setSubmitStatus('submitting');
                try {
                    await fetch(GOOGLE_SHEET_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify({
                            studentName: gameState.studentName, studentClass: gameState.studentClass,
                            score: gameState.score, timer: gameState.timer,
                            selectedList: gameState.selectedList, difficulty: gameState.difficulty, mode: gameState.mode
                        }),
                    });
                    setSubmitStatus('success');
                } catch (error) { setSubmitStatus('error'); }
            };

            const initGame = useCallback(() => {
                initAudio();
                setSubmitStatus('idle');
                let wordCount = gameState.difficulty.includes('Hard') ? 20 : gameState.difficulty.includes('Medium') ? 15 : 10;
                const pool = [...VOCABULARY[gameState.selectedList]].sort(() => Math.random() - 0.5).slice(0, wordCount);
                const gameCards = [];
                pool.forEach(item => {
                    gameCards.push({ vocabId: item.id, uniqueId: `${item.id}-t`, content: item.entry, type: 'term' });
                    gameCards.push({
                        vocabId: item.id, uniqueId: `${item.id}-m`,
                        content: gameState.mode === 'English-Arabic' ? item.meaningArabic : item.meaningEnglish,
                        isArabic: gameState.mode === 'English-Arabic', type: 'match'
                    });
                });
                setCards(gameCards.sort(() => Math.random() - 0.5));
                setFlippedCards([]);
                setGameState(prev => ({ ...prev, score: 0, timer: 0, isGameStarted: true, isGameOver: false, matchedPairs: [] }));
            }, [gameState.selectedList, gameState.mode, gameState.difficulty]);

            const handleCardClick = (index) => {
                if (flippedCards.length === 2 || flippedCards.includes(index) || gameState.matchedPairs.includes(cards[index].vocabId)) return;
                if (!isMuted) playFlip();
                const newFlipped = [...flippedCards, index];
                setFlippedCards(newFlipped);
                if (newFlipped.length === 2) {
                    if (cards[newFlipped[0]].vocabId === cards[newFlipped[1]].vocabId) {
                        setTimeout(() => {
                            if (!isMuted) playMatch();
                            setGameState(prev => {
                                const newMatched = [...prev.matchedPairs, cards[newFlipped[0]].vocabId];
                                return { ...prev, matchedPairs: newMatched, score: prev.score + 10, isGameOver: newMatched.length === cards.length / 2 };
                            });
                            setFlippedCards([]);
                        }, 600);
                    } else {
                        setTimeout(() => { if (!isMuted) playError(); setFlippedCards([]); }, 1200);
                    }
                }
            };

            if (!gameState.isGameStarted) {
                return (
                    <div className="min-h-screen bg-slate-50 flex flex-col">
                        <Header isMuted={isMuted} onToggleMute={() => setIsMuted(!isMuted)} />
                        <main className="flex-1 flex items-center justify-center p-4">
                            <div className="max-w-md w-full bg-white rounded-3xl shadow-xl p-6 sm:p-8 border border-slate-100">
                                <h2 className="text-2xl sm:text-3xl font-black text-slate-900 mb-2">Student Portal</h2>
                                <div className="space-y-4">
                                    <div className="grid grid-cols-2 gap-3">
                                        <input type="text" className="w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm" placeholder="Name" value={gameState.studentName} onChange={(e) => setGameState(prev => ({ ...prev, studentName: e.target.value }))} />
                                        <input type="text" className="w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm" placeholder="Class" value={gameState.studentClass} onChange={(e) => setGameState(prev => ({ ...prev, studentClass: e.target.value }))} />
                                    </div>
                                    <select className="w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm" value={gameState.difficulty} onChange={(e) => setGameState(prev => ({ ...prev, difficulty: e.target.value }))}>
                                        <option value="Easy (10 words)">Easy (10 words)</option>
                                        <option value="Medium (15 words)">Medium (15 words)</option>
                                        <option value="Hard (20 words)">Hard (20 words)</option>
                                    </select>
                                    <select className="w-full px-4 py-3 bg-slate-50 border rounded-xl text-sm" value={gameState.selectedList} onChange={(e) => setGameState(prev => ({ ...prev, selectedList: e.target.value }))}>
                                        {Object.keys(VOCABULARY).map(l => <option key={l} value={l}>{l}</option>)}
                                    </select>
                                    <button disabled={!gameState.studentName || !gameState.studentClass} className="w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white font-black py-4 rounded-2xl transition-all shadow-lg shadow-indigo-100" onClick={initGame}>Start Training</button>
                                </div>
                            </div>
                        </main>
                    </div>
                );
            }

            if (gameState.isGameOver) {
                return (
                    <div className="min-h-screen bg-indigo-600 flex items-center justify-center p-6">
                        <div className="max-w-lg w-full bg-white rounded-3xl shadow-2xl p-10 text-center">
                            <h2 className="text-3xl sm:text-4xl font-black text-slate-900 mb-2">Excellent Work!</h2>
                            <div className="grid grid-cols-2 gap-4 mb-8">
                                <div className="bg-slate-50 p-4 rounded-2xl border">Score: <span className="font-black text-indigo-600">{gameState.score}</span></div>
                                <div className="bg-slate-50 p-4 rounded-2xl border">Time: <span className="font-black text-indigo-600">{gameState.timer}s</span></div>
                            </div>
                            <button className="w-full bg-indigo-600 text-white font-black py-4 rounded-2xl" onClick={() => setGameState(prev => ({ ...prev, isGameStarted: false }))}>New Challenge</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 flex flex-col pb-10">
                    <Header isMuted={isMuted} onToggleMute={() => setIsMuted(!isMuted)} />
                    <div className="bg-white border-b px-4 sm:px-6 py-4 shadow-sm sticky top-[65px] sm:top-[73px] z-40 flex justify-between items-center">
                        <div className="flex gap-4 sm:gap-6">
                            <div><span className="text-[10px] font-black uppercase text-slate-400">Score</span><div className="font-black">{gameState.score}</div></div>
                            <div><span className="text-[10px] font-black uppercase text-slate-400">Timer</span><div className="font-black">{gameState.timer}s</div></div>
                        </div>
                        <div className="font-bold text-slate-700 text-xs sm:text-base text-right">{gameState.studentName}<br/><span className="text-slate-400 text-[10px]">{gameState.studentClass}</span></div>
                    </div>
                    <main className="flex-1 max-w-6xl mx-auto w-full p-4 sm:p-6 mt-4">
                        <div className={`grid gap-3 sm:gap-4 ${gameState.difficulty.includes('Easy') ? 'grid-cols-2 sm:grid-cols-4 lg:grid-cols-5' : 'grid-cols-3 sm:grid-cols-5 lg:grid-cols-6'}`}>
                            {cards.map((card, idx) => (
                                <VocabCard key={card.uniqueId} card={card} isFlipped={flippedCards.includes(idx)} isMatched={gameState.matchedPairs.includes(card.vocabId)} onClick={() => handleCardClick(idx)} />
                            ))}
                        </div>
                    </main>
                </div>
            );
        }

        const rootElement = document.getElementById('root');
        if (rootElement) {
            const root = ReactDOM.createRoot(rootElement);
            root.render(<App />);
        }
    </script>
</body>
</html>
